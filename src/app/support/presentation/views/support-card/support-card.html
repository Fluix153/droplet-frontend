<div class="support-container">
    <div class="support-layout">
        <!-- Columna izquierda: Formulario -->
        <div class="form-section">
            <mat-card class="support-card">
                <mat-card-header>
                    <mat-card-title>Create Support Ticket</mat-card-title>
                </mat-card-header>
                <mat-card-content>
                    <form [formGroup]="ticketForm" (ngSubmit)="onSubmit()">
                        <mat-form-field appearance="outline" class="rounded-field full-width">
                            <mat-label>Subject</mat-label>
                            <input matInput
                                   formControlName="subject"
                                   placeholder="Small title for your ticket">
                            <mat-error
                                    *ngIf="ticketForm.get('subject')?.touched && ticketForm.get('subject')?.hasError('required')">
                                Subject is required
                            </mat-error>
                        </mat-form-field>

                        <mat-form-field appearance="outline" class="rounded-field full-width">
                            <mat-label>Select a Priority</mat-label>
                            <mat-select formControlName="priority">
                                <mat-option value="Low">Low</mat-option>
                                <mat-option value="Medium">Medium</mat-option>
                                <mat-option value="High">High</mat-option>
                                <mat-option value="Critical">Critical</mat-option>
                            </mat-select>
                            <svg class="select-icon" width="16" height="16" viewBox="0 0 16 16" fill="none">
                                <path d="M2 4h12M2 8h12M2 12h12" stroke="#666" stroke-width="1.5"
                                      stroke-linecap="round"/>
                            </svg>
                            <mat-error
                                    *ngIf="ticketForm.get('priority')?.touched && ticketForm.get('priority')?.hasError('required')">
                                Priority is required
                            </mat-error>
                        </mat-form-field>

                        <mat-form-field appearance="outline" class="rounded-field full-width">
                            <mat-label>Explain your problem, detail as much as needed</mat-label>
                            <textarea matInput
                                      formControlName="description"
                                      rows="4"
                                      placeholder="Describe your issue in detail">
                    </textarea>
                            <mat-error
                                    *ngIf="ticketForm.get('description')?.touched && ticketForm.get('description')?.hasError('required')">
                                Description is required
                            </mat-error>
                        </mat-form-field>

                        <div class="send-wrap">
                            <button mat-raised-button
                                    type="submit"
                                    class="send-btn"
                                    [disabled]="ticketForm.invalid || isLoading"
                                    [attr.aria-disabled]="ticketForm.invalid || isLoading">
                                <mat-spinner *ngIf="isLoading" diameter="20"></mat-spinner>
                                <span *ngIf="!isLoading">Send</span>
                            </button>
                        </div>
                    </form>
                </mat-card-content>
            </mat-card>
        </div>


        <!-- Columna derecha: Tickets recientes -->
        <div class="tickets-section">
            <mat-card class="tickets-card">
                <mat-card-header>
                    <mat-card-title>Recent Tickets</mat-card-title>
                </mat-card-header>
                <mat-card-content>
                    <div *ngIf="tickets$ | async as tickets; else loading">
                        <div *ngIf="tickets.length === 0" class="no-tickets">
                            <p>No tickets found. Create your first support ticket!</p>
                        </div>
                        <div *ngFor="let ticket of tickets" class="ticket-item">
                            <mat-card class="ticket-card">
                                <mat-card-content>
                                    <div class="ticket-header">
                                        <h4 class="ticket-subject">{{ ticket.subject }}</h4>
                                        <mat-chip [color]="getChipColor(ticket.status)" selected>
                                            {{ ticket.status }}
                                        </mat-chip>
                                    </div>
                                    <div class="ticket-info">
                                        <p class="ticket-number">Ticket #{{ ticket.ticketNumber || 'N/A' }}</p>
                                        <p class="ticket-priority">Priority: {{ ticket.priority }}</p>
                                        <p class="ticket-date">Created: {{ ticket.createdAt ? (ticket.createdAt | date:'short') : 'N/A' }}</p>
                                    </div>
                                </mat-card-content>
                            </mat-card>
                        </div>
                    </div>
                    <ng-template #loading>
                        <div class="loading-container">
                            <mat-spinner diameter="40"></mat-spinner>
                            <p>Loading tickets...</p>
                        </div>
                    </ng-template>
                </mat-card-content>
            </mat-card>
        </div>
    </div>
</div>
